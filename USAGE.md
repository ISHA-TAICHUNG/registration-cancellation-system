# 課程報名確認系統 - 操作說明

## 系統簡介

中華民國工業安全衛生協會附設台中職業訓練中心的**課程報名確認系統**，供學員查詢報名狀態、確認上課或取消報名。

---

## 學員操作說明

### 1. 進入系統

開啟瀏覽器，輸入網址進入系統首頁。

### 2. 查詢報名

1. 在「身分證字號」欄位輸入您的**身分證字號**（如：A123456789）
2. 點擊「**🔍 查詢報名**」按鈕
3. 系統會顯示您所有的報名紀錄

### 3. 確認上課

當您確定要參加課程時：

1. 找到您要確認的課程
2. 點擊「**✓ 確定上課**」綠色按鈕
3. 系統會自動：
   - 將報名狀態更新為「已確認」
   - 開啟報到系統頁面（新分頁）

### 4. 取消報名

如需取消報名：

1. 點擊「**✕ 取消上課**」紅色按鈕
2. 在出現的輸入框中輸入「**我確定取消**」（需完全一致）
3. 點擊「**取消報名**」按鈕確認
4. 系統會將報名狀態更新為「已取消」

> ⚠️ **注意**：取消報名後無法自行恢復，請謹慎操作。

---

## 報名狀態說明

| 狀態 | 說明 |
|------|------|
| 🟢 **已報名** | 已完成報名，可進行確認或取消 |
| 🟣 **已確認** | 已確認上課，仍可取消 |
| 🔴 **已取消** | 已取消報名，無法操作 |

---

## 常見問題

### Q1: 查詢不到報名資料？
- 請確認身分證字號輸入正確（含英文字母大寫）
- 若仍查無資料，請聯繫訓練中心確認報名狀態

### Q2: 系統顯示「請求過於頻繁」？
- 系統設有請求限制，請稍等 15 分鐘後再試
- 避開尖峰時段使用

### Q3: 手機無法正常顯示？
- 請嘗試重新整理頁面
- 清除瀏覽器快取後再試

### Q4: 確認上課後開啟的報到系統需要驗證碼？
- 報到系統為協會另一系統，請依該系統指示操作
- 系統已自動帶入您的姓名和身分證後五碼

---

## 技術支援

如有任何問題，請聯繫：

**中華民國工業安全衛生協會附設台中職業訓練中心**

---

## 系統管理員說明

### 環境需求

- Node.js 18+
- npm

### 環境變數設定

複製 `.env.example` 為 `.env`，並填入以下資訊：

```env
# Google Sheets 設定
GOOGLE_SHEET_ID=您的試算表ID
GOOGLE_CREDENTIALS={"type":"service_account",...}  # 或使用下方路徑
GOOGLE_CREDENTIALS_PATH=./credentials.json

# 伺服器設定
PORT=3000

# CORS 設定（留空允許所有來源，生產環境建議設定白名單）
CORS_ORIGINS=https://your-domain.com

# Rate Limit 設定
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX=10

# reCAPTCHA v3 設定（防止自動化攻擊）
# 從 https://www.google.com/recaptcha/admin 申請
RECAPTCHA_SECRET_KEY=您的reCAPTCHA_Secret_Key
```

### Google Sheets 格式

試算表需包含以下欄位（第一列為標題）：

| 身分證字號 | 姓名 | 課程名稱 | 開課日期 | 狀態 | 操作時間 | IP | UA | 承辦人LINE_ID |
|-----------|------|---------|---------|------|---------|----|----|--------------|

### 啟動服務

```bash
# 安裝依賴
npm install

# 啟動開發伺服器
npm start
```

服務預設運行於 `http://localhost:3000`

### 部署至 Render

1. 將程式碼推送至 GitHub
2. 在 Render 建立 Web Service
3. 設定環境變數（同上，記得加入 `RECAPTCHA_SECRET_KEY`）
4. 部署完成後即可使用

---

## 安全機制

| 機制 | 說明 |
|------|------|
| **reCAPTCHA v3** | 自動阻擋機器人和腳本攻擊 |
| **Rate Limiting** | 每 IP 15 分鐘內最多 10 次請求 |
| **姓名遮蔽** | 畫面顯示部分遮蔽姓名（如：王＊明） |
| **身分證驗證** | 格式檢查避免無效輸入 |
| **XSS 防護** | 輸出內容 HTML 編碼 |
| **操作記錄** | 記錄 IP、User-Agent、時間戳 |

---

*最後更新：2024年12月*

